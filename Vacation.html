<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vacation</title>
  <link rel="icon" href="img/SK logo2.png" type="image/png" />

  <!-- Boxicons + Icons -->
  <link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />

  <!-- Styles -->
  <link rel="stylesheet" href="Styles/shared.css" />
  <link rel="stylesheet" href="Styles/Vacation.css" />
</head>

<body>
  <!-- SIDEBAR -->
	<section id="sidebar">

		<!--Logo part-->
		<a href="Home.html" class="brand">

			<img src="img/SK logo2.png" style="padding: 10px;  max-width: 30px;">
			<img class="logo" src="img/SK logo3.png">

		</a>

		<!-- menu items -->
		<ul class="side-menu top">
			<li>
				<a href="Home.html">
					<i class="bx bxs-home"> </i>
					<span class="text"> Home</span>
				</a>
			</li>
			
    
  <li>
    <a href="my_team.html">
      <i class="bx bxs-group"></i>
      <span class="text">My Department</span>
    </a>
  </li>
			<li>
				<a href="Excellent Works Manager.html">
					<i class='bx bx-star'></i>
					<span class="text"> Excellent Works</span>
				</a>
			</li>
			<li>
				<a href="employeeCourses.html">
					<i class="bx bx-certification"></i>
					<span class="text"> Course</span>
				</a>
			</li>
			<li class="active">
				<a href="Vacation.html">
					<i class='bx bxs-plane-alt'></i>
					<span class="text"> Vacation</span>
				</a>
			</li>
		</ul>



		<!--log out part-->
		<ul class="side-menu">
			<li>
				<a href="login.html" class="logout">
					<i class='bx bxs-log-out-circle'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>

	</section>
	<!-- SIDEBAR -->

  <!-- CONTENT -->
  <section id="content">
   <nav>
			<i class='bx bx-menu'></i>
			<div class="head-title">
				<div class="left">
					<h1>Home</h1>
				</div>
			</div>






			<a class="profile-link">
				<div class="nav-right">

					<!-- 1) Avatar + name -->
					<div class="profile" onclick="location.href='Profile.html'">
						<img src="img/profile.png" alt="Profile">
						<div class="username">Lama
						</div>
					</div>


					<div class="points">
						<h2>125</h2>
						<p>Points</p>
					</div>


					<div class="notification-icon" onclick="location.href='Notification.html'">
						<i class='bx bxs-bell'></i>
						<span class="badge">3</span>
					</div>


				</div>
			</a>




		</nav>

    <!-- MAIN -->
    <main>

      <div class="content-wrapper">



        <div class="leaves-container">
          <h1 class="page-title">Requests Vacation</h1>


          <!-- FORM -->
          <div class="leave-form">
            <div class="form-group full-width">
              <label>Vacation Type</label>
              <select class="basic-select">
                <option>Annual leave</option>
                <option>Sick leave</option>
                <option>Unpaid leave</option>
                <option>Personal leave</option>
                <option>Emergency leave</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Start Date</label>
                <div class="input-with-icon calendar">
                  <i class="bx bx-calendar"></i>
                  <button id="startDateBtn" type="button" class="calendar-btn">
                    <span id="startDateText">Select date</span>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label>End Date</label>
                <div class="input-with-icon calendar">
                  <i class="bx bx-calendar"></i>
                  <button id="endDateBtn" type="button" class="calendar-btn">
                    <span id="endDateText">Select date</span>
                  </button>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Duration</label>
                <div class="input-with-icon readonly">
                  <i class="bx bx-time"></i>
                  <input type="text" id="durationInput" placeholder="Days" readonly />
                </div>
              </div>

              <div class="form-group">
                <label>Replacement</label>
                <div class="replacement-select" id="replacementContainer">
                  <button id="chooseReplacementBtn" class="circle-btn" type="button">+</button>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <div class="input-with-icon file-upload" id="triggerExcuseUpload">
                  <i class="bx bx-upload"></i>
                  <span>Upload a file</span>
                  <input type="file" id="excuseFileInput" hidden />
                </div>
              </div>

              <div class="form-group">
                <button type="button" class="submit-btn outlined">Submit</button>
              </div>
            </div>
          </div>
        </div>

        <!-- CARD -->


        <div class="balance-cards vertical">
          <div class="leave-balance-card">
            <h3>Annual</h3>
            <p><span class="highlight">11</span> Days Left</p>
            <p><span class="highlight">19</span> Days Taken</p>
            <p><span class="highlight">1</span> Pending Request</p>
          </div>

          <div class="leave-balance-card">
            <h3>Sicks</h3>
            <p><span class="highlight">9</span> Days Left</p>
            <p><span class="highlight">1</span> Days Taken</p>
            <p><span class="highlight">0</span> Pending Request</p>
          </div>
        </div>



      </div>

      <!-- ========== Dialogs ========== -->

      <!-- Calendar Dialog -->
      <dialog id="calendarDialog">
        <div class="calendar">
          <div class="header">
            <div id="prev" class="btn"><i class="fa-solid fa-arrow-left"></i></div>
            <div id="month-year">Apr 2025</div>
            <div id="next" class="btn"><i class="fa-solid fa-arrow-right"></i></div>
          </div>
          <div class="weekdays">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
          </div>
          <div class="days" id="days"></div>
        </div>
      </dialog>

      <!-- Replacement Dialog -->
      <dialog id="empDialog" class="modal">
        <div class="modal-content">
          <span class="close-btn" onclick="document.getElementById('empDialog').close()">&times;</span>
          <h2>Select Replacement</h2>
          <ul class="emp-list">
            <li data-name="Employee 1" data-img="img/profile.png"><img src="img/profile.png" /><span>Layan</span></li>
            <li data-name="Employee 2" data-img="img/profile.png"><img src="img/profile.png" /><span>Lian</span></li>
            <li data-name="Employee 3" data-img="img/SK logo2.png"><img src="img/SK logo2.png" /><span>Arob</span></li>
          </ul>
          <div class="actions">
            <button type="button" onclick="document.getElementById('empDialog').close()">Cancel</button>
            <button id="openTaskModal">Next</button>
          </div>
        </div>
      </dialog>

      <!-- No Replacement Confirmation -->
      <dialog id="noReplacementDialog" class="confirm-dialog">
        <div class="modal-content">
          <p>No replacement selected. Do you want to continue?</p>
          <div class="actions">
            <button id="cancelNoReplaceBtn">No</button>
            <button id="confirmNoReplaceBtn">Yes</button>
          </div>
        </div>
      </dialog>

      <!-- Task Dialog -->
      <dialog id="taskDialog">
        <div class="headerDialog">
          <h3>Replacement Tasks</h3>
          <button class="closeBtn"><i class='bx bxs-x-circle'></i></button>
        </div>
        <ul class="list task-list">
          <!-- العناصر ستُولّد جافاسكربتياً -->
        </ul>
        <button class="continue-btn" disabled>Continue</button>
      </dialog>


      <!-- Success Message -->
      <div id="vacationMessage" class="message-bar success">Task added successfully!</div>

      </div> <!-- /leaves-container -->
    </main>
  </section>

  <!-- Scripts -->
  <script src="script/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ====== 1. Calendar Widget ======
      const calendarDialog = document.getElementById("calendarDialog");
      const daysContainer = document.getElementById("days");
      const monthYear = document.getElementById("month-year");
      const prevButton = document.getElementById("prev");
      const nextButton = document.getElementById("next");
      let currentDate = new Date();
      let targetSpan = null;
      const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

      function renderCalendar(date) {
        const year = date.getFullYear(),
          month = date.getMonth(),
          firstDay = new Date(year, month, 1).getDay(),
          lastDay = new Date(year, month + 1, 0).getDate();

        monthYear.textContent = `${months[month]} ${year}`;
        daysContainer.innerHTML = '';

        // هل في حقل هدف (start أو end) محدد؟
        const isStart = targetSpan && targetSpan.id === 'startDateText';
        let otherDate = null;
        if (targetSpan) {
          const otherText = isStart
            ? document.getElementById('endDateText').textContent
            : document.getElementById('startDateText').textContent;
          if (!otherText.includes('Select')) {
            otherDate = new Date(otherText);
          }
        }

        // خانات الفارغة
        for (let i = 0; i < firstDay; i++) {
          daysContainer.innerHTML += '<div class="fade"> </div>';
        }

        // أيام الشهر
        for (let d = 1; d <= lastDay; d++) {
          const dayDate = new Date(year, month, d);
          const dayDiv = document.createElement('div');
          dayDiv.textContent = d;

          // علامة اليوم الحالي
          if (
            d === new Date().getDate() &&
            month === new Date().getMonth() &&
            year === new Date().getFullYear()
          ) {
            dayDiv.classList.add('today');
          }

          // إذا otherDate مُعرّفة، عطّل الأيام غير المنطقية
          if (otherDate) {
            if (isStart && dayDate > otherDate) dayDiv.classList.add('disabled');
            if (!isStart && dayDate < otherDate) dayDiv.classList.add('disabled');
          }

          // فقط الأيام غير المعطلة تستجيب للنقر
          if (!dayDiv.classList.contains('disabled')) {
            dayDiv.addEventListener('click', () => {
              const formatted = `${months[month]} ${d} ${year}`;
              targetSpan.textContent = formatted;
              updateDuration();
              calendarDialog.close();
            });
          }

          daysContainer.appendChild(dayDiv);
        }
      }



      function positionDialog(btn) {
        const r = btn.getBoundingClientRect();
        calendarDialog.style.top = `${r.bottom + window.scrollY + 5}px`;
        calendarDialog.style.left = `${r.left + window.scrollX}px`;
      }

      document.getElementById("startDateBtn").addEventListener("click", function () {
        targetSpan = document.getElementById("startDateText");
        positionDialog(this);
        calendarDialog.showModal();
        renderCalendar(currentDate);
      });
      document.getElementById("endDateBtn").addEventListener("click", function () {
        targetSpan = document.getElementById("endDateText");
        positionDialog(this);
        calendarDialog.showModal();
        renderCalendar(currentDate);
      });
      prevButton.addEventListener("click", () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(currentDate); });
      nextButton.addEventListener("click", () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(currentDate); });
      window.addEventListener("click", e => { if (e.target === calendarDialog) calendarDialog.close(); });
      renderCalendar(currentDate);

      function updateDuration() {
        const start = document.getElementById("startDateText").textContent;
        const end = document.getElementById("endDateText").textContent;
        const out = document.getElementById("durationInput");
        if (!start.includes("Select") && !end.includes("Select")) {
          const s = new Date(start), e = new Date(end);
          if (!isNaN(s) && !isNaN(e) && e >= s) {
            const days = Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
            out.value = `${days} Days`;
          } else out.value = "Invalid Range";
        }
      }

      // ====== 2. Replacement → Multi-Task Assignment ======
      const plusBtn = document.getElementById('chooseReplacementBtn');
      const repContainer = document.getElementById('replacementContainer');
      const empDialog = document.getElementById('empDialog');
      const nextBtn = document.getElementById('openTaskModal');
      const taskDialog = document.getElementById('taskDialog');
      const listEl = taskDialog.querySelector('.task-list');
      const contBtn = taskDialog.querySelector('.continue-btn');

      let selectedEmployee = null;
      let selectedTasks = [];

      // حط مهامك هنا
      const tasks = [
        { title: 'Update Design System Components', description: 'Standardize button styles and text inputs across all Figma files', deadline: '8 Apr' },
        { title: 'Client Feedback Review', description: 'Go through client’s notes and mark UI areas needing revision', deadline: '8 Apr' }
      ];

      // 2.1 افتح حوار اختيار البديل
      plusBtn.addEventListener('click', () => {
        empDialog.showModal();
        empDialog.querySelectorAll('.emp-list li').forEach(li => li.classList.remove('selected'));
      });

      // 2.2 اختر موظف
      empDialog.querySelectorAll('.emp-list li').forEach(item => {
        item.addEventListener('click', () => {
          empDialog.querySelectorAll('.emp-list li').forEach(li => li.classList.remove('selected'));
          item.classList.add('selected');
        });
      });

      // 2.3 زر Next → جهّز قائمة المهام
      nextBtn.addEventListener('click', () => {
        const sel = empDialog.querySelector('.emp-list li.selected');
        if (!sel) { alert('Please select a replacement first.'); return; }
        selectedEmployee = { name: sel.dataset.name, img: sel.dataset.img };
        empDialog.close();

        // reset
        listEl.innerHTML = '';
        selectedTasks = [];
        contBtn.disabled = true;

        // generate tasks
        tasks.forEach((t, i) => {
          const li = document.createElement('li');
          
          li.innerHTML = `
        <label style="display:flex; flex-direction:column; gap:4px; cursor:pointer;">
          <div style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" data-idx="${i}" />
            <strong>${t.title}</strong>
          </div>
          <p style="margin:0; font-size:12px; ">${t.description} — Due ${t.deadline}</p>
        </label>
      `;
          listEl.append(li);
          // داخل القسم اللي يولّد المهام (بعد li.innerHTML و append)
li.querySelector('input').addEventListener('change', e => {
  if (e.target.checked) {
    selectedTasks.push(i);
    li.classList.add('selected');     // ضيف كلاس selected
  } else {
    selectedTasks = selectedTasks.filter(x => x !== i);
    li.classList.remove('selected');  // شيل الكلاس لو شيل التحديد
  }
  contBtn.disabled = selectedTasks.length === 0;
});


          // checkbox handler
          li.querySelector('input').addEventListener('change', e => {
            if (e.target.checked) selectedTasks.push(i);
            else selectedTasks = selectedTasks.filter(x => x !== i);
            contBtn.disabled = selectedTasks.length === 0;
          });
        });

        taskDialog.showModal();
      });

      // 2.4 زر Continue → عرض avatar و حفظ المهام
      

        // إعادة الاختيار عند النقر على الصورة

        // 2.4 زر Continue → عرض صورة البديل وربط إعادة الاختيار
contBtn.addEventListener('click', () => {
  // 1) أقفل مودال المهام
  taskDialog.close();
  // 2) أخفي زر "+"
  plusBtn.style.display = 'none';
  // 3) نظّف حاوية البديل
  repContainer.innerHTML = '';

  // 4) أنشئ wrapper وداخلها الصورة
  const wrap = document.createElement('div');
  wrap.classList.add('invatedEmp');
  wrap.style.cursor = 'pointer';

  const img = document.createElement('img');
  img.src = selectedEmployee.img;
  img.alt = selectedEmployee.name;
  img.title = selectedEmployee.name;
  img.style.width = '45px';
  img.style.height = '45px';
  img.style.borderRadius = '50%';

  // 5) عند النقر على الصورة → نظّف وعدّل الواجهة وأعد فتح empDialog
  img.addEventListener('click', () => {
  empDialog.showModal();
});


  wrap.append(img);
  repContainer.append(wrap);

  console.log(
    'Assigned to',
    selectedEmployee.name,
    selectedTasks.map(i => tasks[i].title)
  );




      });


      // 2.5 إغلاق dialog المهام
      taskDialog.querySelectorAll('.closeBtn').forEach(btn => {
        btn.addEventListener('click', () => taskDialog.close());
      });



      // ========== رفع العذر ==========
    const trigger = document.getElementById("triggerExcuseUpload");
    const fileInput = document.getElementById("excuseFileInput");

    trigger.addEventListener("click", function () {
      fileInput.click();
    });

    fileInput.addEventListener("change", function () {
      if (fileInput.files.length > 0) {
        const fileName = fileInput.files[0].name;
        trigger.querySelector("span").textContent = fileName;
      }
    });


    });




  </script>

</body>

</html>